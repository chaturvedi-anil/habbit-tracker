
<main>
    <% if(locals.user) { %> 

        <!-- habbit form -->
        <div id="add-habbit-form-container">
            <h1>Add New Habbit</h1> 
            <form action="/habbit/create" method="POST">
                <input class="text-box" type="text" name="content" placeholder="Enter Habbit" required>
                <input class="btn" type="submit" value="Add Habbit">
            </form>
        </div>
    <div class="habit-container text-center">
        <h2>Start with a new habit today!</h2>
        <form action="/users/user-view" method="POST" class="habit-header">
            <div class="btn-group mb-4" aria-label="Change View">
                <% if(user.view === "daily"){ %>
                <button type="submit" class="btn btn-primary active" aria-pressed="true">Daily</button>
                <button type="submit" class="btn btn-primary">Weekly</button>
                <% } else { %>
                <button type="submit" class="btn btn-primary">Daily</button>
                <button type="submit" class="btn btn-primary active" aria-pressed="true">Weekly</button>
                <% } %>
            </div>
        </form>
        <div class="habit">
            <i class="fas fa-check-circle" style="color: rgb(143, 233, 58);"></i>
            -Done&emsp;&emsp;
            <i class="fas fa-times-circle" style="color: #E53C37;"></i>
            -Not Done&emsp;&emsp;
            <i class="fas fa-minus-circle" style="color: gold;"></i>
            -Unmarked&emsp;&emsp;
            <% if(user.view === "daily"){ %>
            <ul class="habit-list">
                <% habbits.forEach(details => { let tzoffset = (new Date()).getTimezoneOffset() * 60000, found=false, status='';
                    var today = (new Date(Date.now() - tzoffset)).toISOString().slice(0, 10);
                    details.dates.find(function (item, index) {
                        if(item.date === today)
                        {
                            found = true;
                            status = item.complete;
                        }
                    });
                    %>
                <li class="habit-list-item">
                    <a href="/habbit/status-update/<%= details._id %>&date=<%= today %>" class="status">
                        <% if(found && status==='yes'){ %>
                        <i class="fas fa-check-circle"></i>
                        <% } else if(found && status==='no'){ %>
                        <i class="fas fa-times-circle"></i>
                        <% } else { %>
                        <i class="fas fa-minus-circle"></i>
                        <% } %>
                    </a>
                    &emsp;
                    <div class="habit-list-item-name"><%= details.content %></div>
                    <a href="/habbit/delete/<%= details._id %>" class="remove">
                        <i class="far fa-trash-alt"></i>
                    </a>
                </li>
                <% }) %>
            </ul>
            <% } else { %>
            <ul class="habit-list text-center">
                <% habbits.forEach(details => { %>
                <li class="habit-list-item">
                    <div class="habit-list-item-name"><%= details.content %></div>
                    <a href="/habbit/delete/<%= details._id %>" class="remove">
                        <i class="far fa-trash-alt"></i>
                    </a>
                    <% days.forEach(day => { let found = false, status = '';
                    details.dates.find(function (item, index) {
                        if(item.date === day.date)
                        {
                            found = true;
                            status = item.complete;
                        }
                    });
                    %>
                    <div class="dotw">
                        <div class="day mt-0"><span><%= day.day + ", " + day.date.slice(-2) %></span></div>
                        <a href="/habbit/status-update/<%= details._id %>&date=<%= day.date %>" class="status2 mt-4">
                            <% if(found && status==='yes'){ %>
                            <i class="fas fa-check-circle"></i>
                            <% } else if(found && status==='no'){ %>
                            <i class="fas fa-times-circle"></i>
                            <% } else { %>
                            <i class="fas fa-minus-circle"></i>
                            <% } %>
                        </a>
                    </div>
                    <% }) %>
                </li>
                <% }) %>
            </ul>
            <% } %>
        </div>
    </div>
    <% } else { %>
        <p>
           Lorem ipsum dolor sit amet consectetur adipisicing elit. Non a rerum voluptates ea assumenda. Facere cumque debitis rerum rem nisi aspernatur est minus, voluptatum, ea recusandae reiciendis autem fuga! Quis.
           Fugiat delectus molestias ea aut quidem nam maiores dolor aperiam accusantium atque, veniam minus laudantium a ut tenetur quo alias libero ab soluta quasi labore! Nulla excepturi doloremque quaerat omnis?
           Aliquam quis provident quos iste eligendi fuga at voluptatum quasi error quibusdam officiis consequatur porro assumenda, tempore repudiandae, sunt nobis libero reiciendis soluta alias earum. Qui voluptates laudantium accusantium quasi.
           Debitis sed maxime facilis, ratione earum amet aperiam dolorum modi quas velit possimus optio neque soluta quasi similique commodi. Culpa facere magnam earum optio voluptatibus? Cupiditate ab asperiores quo! Aut!
           Eligendi blanditiis ad nam id quos suscipit itaque earum, quas rem aspernatur doloremque labore explicabo cumque ut totam magni accusantium praesentium! Commodi fugit nulla nobis itaque suscipit nemo iste veritatis.
        </p>
    <% } %> 
</main>

